<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FutureFlow Finance - Track Your Spending with AI</title>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script type="module" src="../static/js/firebase.js"></script>

    <style>
        :root {
            --bg-dark: #111827;
            --bg-card: #1F2937;
            --text-primary: #F3F4F6;
            --text-secondary: #9CA3AF;
            --accent: #2DD4BF;
            --accent-dark: #14B8A6;
            --border-color: #374151;
        }

        body {
            font-family: 'Poppins', sans-serif;
            background-color: var(--bg-dark);
            color: var(--text-primary);
        }

        #google-signin-btn {
            background-color: #4285F4;
            color: white;
            border: none;
            padding: 10px 24px;
            font-size: 16px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        #google-signin-btn:hover {
            background-color: #357ae8;
        }

        #google-signin-btn svg {
            margin-right: 12px;
            background-color: white;
            border-radius: 50%;
            padding: 2px;
        }
    </style>
</head>

<body class="p-4 sm:p-8">
    <div class="w-full max-w-6xl mx-auto">
        <header class="flex justify-between items-center py-4">
            <div class="logo">
                <h1 class="text-2xl sm:text-3xl font-bold tracking-wider" style="color: var(--accent);">FutureFlow
                    Finance</h1>
            </div>
            <div id="auth-container" class="flex items-center">
                <div id="google-signin-container">
                    <button id="google-signin-btn">
                        <svg xmlns="http://www.w3.org/2000/svg" x="0px" y="0px" width="24" height="24"
                            viewBox="0 0 48 48">
                            <path fill="#FFC107"
                                d="M43.611,20.083H42V20H24v8h11.303c-1.649,4.657-6.08,8-11.303,8c-6.627,0-12-5.373-12-12c0-6.627,5.373-12,12-12c3.059,0,5.842,1.154,7.961,3.039l5.657-5.657C34.046,6.053,29.268,4,24,4C12.955,4,4,12.955,4,24s8.955,20,20,20s20-8.955,20-20C44,22.659,43.862,21.35,43.611,20.083z">
                            </path>
                            <path fill="#FF3D00"
                                d="M6.306,14.691l6.571,4.819C14.655,15.108,18.961,12,24,12c3.059,0,5.842,1.154,7.961,3.039l5.657-5.657C34.046,6.053,29.268,4,24,4C16.318,4,9.656,8.337,6.306,14.691z">
                            </path>
                            <path fill="#4CAF50"
                                d="M24,44c5.166,0,9.86-1.977,13.409-5.192l-6.19-5.238C29.211,35.091,26.715,36,24,36c-5.223,0-9.657-3.356-11.303-7.962l-6.571,4.819C9.656,39.663,16.318,44,24,44z">
                            </path>
                            <path fill="#1976D2"
                                d="M43.611,20.083H42V20H24v8h11.303c-0.792,2.237-2.231,4.166-4.087,5.574l6.19,5.238C39.99,34.552,44,29.865,44,24C44,22.659,43.862,21.35,43.611,20.083z">
                            </path>
                        </svg>
                        Sign in with Google
                    </button>
                </div>
                <div id="user-profile" class="hidden cursor-pointer">
                    <img id="user-avatar" class="rounded-full w-10 h-10" alt="User profile avatar" />
                </div>
            </div>
        </header>

        <main class="hero text-center flex flex-col items-center gap-6 mt-12">
            <h2 class="text-2xl sm:text-4xl font-semibold max-w-2xl">Track your spending, forecast your future with AI.
            </h2>
            <p class="text-base sm:text-lg max-w-3xl mb-4" style="color: var(--text-secondary);">
                Effortlessly analyze your UPI screenshots and bank statements. Gain insights, spot trends, and let our
                AI-powered forecasts guide you to financial clarity.
            </p>

            <div class="dashboard-preview w-full max-w-4xl mt-8 rounded-xl border overflow-hidden shadow-2xl"
                style="border-color: var(--border-color); background-color: var(--bg-card);">
                <img src="https://storage.googleapis.com/gemini-prod-us-east1-9556/uploaded/image_1e2654.png"
                    alt="FutureFlow Finance Dashboard Preview" class="w-full h-auto block"
                    onerror="this.onerror=null;this.src='https://placehold.co/900x450/1F2937/F3F4F6?text=Dashboard+Preview';">
            </div>
        </main>
    </div>

    <div id="sidebar-overlay" class="fixed inset-0 bg-black bg-opacity-60 z-30 hidden transition-opacity duration-300">
    </div>

    <aside id="sidebar"
        class="fixed top-0 right-0 h-full w-80 transform translate-x-full transition-transform duration-300 ease-in-out z-40 p-6 flex flex-col"
        style="background-color: var(--bg-card);">
        <div class="flex justify-between items-center mb-8">
            <h2 class="text-xl font-semibold" style="color: var(--text-primary);">Profile</h2>
            <button id="close-sidebar" class="text-3xl font-light hover:text-white"
                style="color: var(--text-secondary);">&times;</button>
        </div>
        <div class="flex flex-col items-center text-center">
            <img id="sidebar-avatar" class="rounded-full w-24 h-24 mb-4 border-2" style="border-color: var(--accent);"
                alt="User profile avatar" />
            <p id="sidebar-name" class="font-semibold text-lg w-full truncate" style="color: var(--text-primary);"></p>
            <p id="sidebar-email" class="text-sm w-full truncate" style="color: var(--text-secondary);"></p>
        </div>
        <div class="mt-auto">
            <button id="signout-button"
                class="w-full py-2 rounded-lg font-semibold transition-colors duration-200 hover:bg-teal-500"
                style="background-color: var(--accent); color: var(--bg-dark);">Sign Out</button>
        </div>
    </aside>

    <script type="module">
        import { app, auth, } from "../static/js/firebase.js"
        import { GoogleAuthProvider, signInWithPopup, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";

        const provider = new GoogleAuthProvider();

        const googleSignInContainer = document.getElementById('google-signin-container');
        const googleSignInBtn = document.getElementById('google-signin-btn');
        const userProfile = document.getElementById('user-profile');
        const userAvatar = document.getElementById('user-avatar');
        const sidebar = document.getElementById('sidebar');
        const sidebarOverlay = document.getElementById('sidebar-overlay');
        const closeSidebarBtn = document.getElementById('close-sidebar');
        const signOutBtn = document.getElementById('signout-button');
        const sidebarAvatar = document.getElementById('sidebar-avatar');
        const sidebarName = document.getElementById('sidebar-name');
        const sidebarEmail = document.getElementById('sidebar-email');

        const signInWithGoogle = () => {
            signInWithPopup(auth, provider)
                .then((result) => {
                    console.log("Successfully signed in with Google", result.user);
                }).catch((error) => {
                    console.error("Error signing in with Google:", error);
                });
        };

        const signOutUser = () => {
            signOut(auth).then(() => {
                console.log("User signed out");
                closeSidebar();
            }).catch((error) => {
                console.error("Error signing out:", error);
            });
        };

        const updateUIForLoggedInUser = (user) => {
            googleSignInContainer.classList.add('hidden');
            userProfile.classList.remove('hidden');

            userAvatar.src = user.photoURL;
            userAvatar.alt = `${user.displayName}'s profile picture`;

            sidebarAvatar.src = user.photoURL;
            sidebarName.textContent = user.displayName;
            sidebarEmail.textContent = user.email;
        };

        const updateUIForLoggedOutUser = () => {
            googleSignInContainer.classList.remove('hidden');
            userProfile.classList.add('hidden');
        };

        const openSidebar = () => {
            sidebar.classList.remove('translate-x-full');
            sidebarOverlay.classList.remove('hidden');
        };

        const closeSidebar = () => {
            sidebar.classList.add('translate-x-full');
            sidebarOverlay.classList.add('hidden');
        };

        onAuthStateChanged(auth, (user) => {
            if (user) {
                updateUIForLoggedInUser(user);
            } else {
                updateUIForLoggedOutUser();
            }
        });

        googleSignInBtn.addEventListener('click', signInWithGoogle);
        userProfile.addEventListener('click', openSidebar);
        closeSidebarBtn.addEventListener('click', closeSidebar);
        sidebarOverlay.addEventListener('click', closeSidebar);
        signOutBtn.addEventListener('click', signOutUser);

    </script>
</body>

</html>